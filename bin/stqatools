#!/usr/bin/env ruby

require 'stqatools'
require 'thor'
require 'pp'

module ValidateInputs
end

module Stqatools
  class MyCLI < Thor
    include Thor::Actions

    default_task :summary

    desc :summary, "Print help for all options."
    def summary
      puts "HEEEEELP"
    end

    desc :start, "Run Vertical, Horizontal or single job."
    method_option :vertical, :type => :boolean, :aliases => '-v', :desc => 'Run vertical'
    method_option :horizontal, :type => :boolean, :aliases => '-h', :desc => 'Run horizontal'
    method_option :job, :type => :boolean, :aliases => '-j', :desc => 'Run single job'
    method_option :prefix, :type => :string, :aliases => '-p', :desc => 'Regex for jobs', :required => :true
    method_option :threshold, :type => :string, :aliases => '-t', :desc => 'Threshold option', :default => 'failure'
    method_option :filter, :type => :array, :aliases => '-f', :desc => 'Filter option for jobs', :default => [1,2]
    method_option :subchains, :type => :array, :aliases => '-s', :desc => 'Split vertical or horizontal to subchains'
    def start
      puts "Vertical" if options[:vertical]
      puts "Horizontal" if options[:horizontal]
      puts "Job" if options[:job]
      puts options[:prefix]
      puts options[:filter].class
      if yes?('Are you sure?', :yellow)
        say 'Delete all', :red
      else
        say "Cancel", :red
        return
      end
    end
 
   
    desc :disable, "Disable all jobs which match prefix."
    method_option :prefix, :type => :string, :aliases => '-p', :desc => 'Regex for jobs', :required => :true
    def disable     
      puts "Disabling jobs which match #{options[:prefix]}"
      Stqatools::CoreRunner.disable_jobs(options[:prefix])
    end

    desc :single, "Run single job."
    method_option :name, :type => :string, :desc => 'Correct job name', :required => :true
    def single
      puts "Running single job #{options[:name]}..."
      Stqatools::CoreRunner.run_single_job(options[:name])
    end

  end
end

# Stqatools::get_jenkins_client 

Stqatools::load_rocket_clouds

Stqatools::MyCLI.start(ARGV)

